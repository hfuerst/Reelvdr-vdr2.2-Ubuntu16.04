#!/bin/sh

if [ -f /var/run/mcli.pid ]; then
	echo "stopping old standalone mcli daemon"
	/etc/init.d/mcli stop
fi

echo "disabling old standalone mcli daemon"
if grep -q MCLI_ENABLED /etc/default/mcli ; then
	sed -i s/MCLI_ENABLED.*/MCLI_ENABLED=\"false\"/ /etc/default/mcli
else
	echo "MCLI_ENABLED=\"false\"" >> /etc/default/mcli
fi

# disabling dvbloop
sed -i /dvbloop/d /etc/modules

# old netcvrotor pi must be disabled when using mcli-pi
if [ -f /etc/reel/p.netcvrotor.conf ]; then
	sed -i s/LOAD_PLUGIN.*/LOAD_PLUGIN=\"false\"/ /etc/reel/p.netcvrotor.conf
fi

# setting sysctl values
if grep -q "net.unix.max_dgram_qlen" /etc/sysctl.conf ; then
	sed -i s/"net.unix.max_dgram_qlen".*/"net.unix.max_dgram_qlen = 1000"/ /etc/sysctl.conf
else
	echo "net.unix.max_dgram_qlen = 1000" >> /etc/sysctl.conf
fi
if grep -q "net.core.rmem_max" /etc/sysctl.conf ; then
	sed -i s/"net.core.rmem_max".*/"net.core.rmem_max = 1048576"/ /etc/sysctl.conf
else
	echo "net.core.rmem_max = 1048576" >> /etc/sysctl.conf
fi
		
# installation scripts should always exit with 0. Otherwise it will create ugly
#  kinds of problems for the end-user.

exit 0
